<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game - Life Arcade</title>
  <style>
    /* ===== LOCAL FONTS (Offline) ===== */
    @font-face {
      font-family: 'Google Sans Flex';
      font-weight: 500;
      font-style: normal;
      font-display: swap;
      src: url('/fonts/GoogleSansFlex-VariableFont_GRAD,ROND,opsz,slnt,wdth,wght.ttf') format('truetype');
    }

    @font-face {
      font-family: 'Google Sans Mono';
      font-weight: 400;
      font-style: normal;
      font-display: swap;
      src: url('/fonts/Google-Sans-Mono-Regular.ttf') format('truetype');
    }

    @font-face {
      font-family: 'Google Sans Mono';
      font-weight: 600;
      font-style: normal;
      font-display: swap;
      src: url('/fonts/Google-Sans-Mono-SemiBold.ttf') format('truetype');
    }

    body {
      margin: 0;
      padding: 0;
      background-color: #FFFFFF;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Google Sans Flex', Arial, sans-serif;
      overflow: hidden;
      position: relative;
    }

    /* Game header overlay */
    #game-header {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: min(1200px, 100vw);
      max-width: 100vw;
      height: clamp(100px, 10vh, 200px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 clamp(40px, 6.67vw, 80px);
      box-sizing: border-box;
      z-index: 1000;
      pointer-events: none;
      gap: clamp(20px, 3vw, 60px);
    }

    #game-title {
      color: #202124;
      font-size: clamp(36px, 3.65vh, 70px);
      font-family: 'Google Sans Flex', Arial, sans-serif;
      font-weight: 500;
      line-height: 1;
      margin: 0;
    }

    .game-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: clamp(10px, 1.15vh, 22px);
    }

    .stat-label {
      color: #202124;
      font-size: clamp(24px, 2.34vh, 45px);
      font-family: 'Google Sans Flex', Arial, sans-serif;
      font-weight: 500;
      line-height: 1;
      margin: 0;
    }

    .stat-value {
      color: #202124;
      font-size: clamp(36px, 3.65vh, 70px);
      font-family: 'Google Sans Flex', Arial, sans-serif;
      font-weight: 500;
      line-height: 1;
      margin: 0;
    }

    #game-stats {
      display: flex;
      gap: clamp(30px, 4vw, 80px);
    }
  </style>
</head>
<body>
  <!-- Game header overlay -->
  <div id="game-header">
    <h1 id="game-title">Game</h1>
    <div id="game-stats">
      <div class="game-stat">
        <div class="stat-label">Score</div>
        <div class="stat-value" id="score-value">0</div>
      </div>
    </div>
  </div>

  <!-- p5.js (Local - Offline) -->
  <script src="/lib/p5.min.js"></script>
  <script type="module">
    // Game title mapping
    const GAME_TITLES = {
      'space-invaders': 'Gemini Invaders',
      'dino-runner': 'Dino Runner',
      'breakout': 'Breakout',
      'flappy-bird': 'Flappy Bird'
    }

    // Get game name from URL parameter
    const urlParams = new URLSearchParams(window.location.search)
    const gameName = urlParams.get('game')

    if (!gameName) {
      console.error('No game specified in URL parameter')
      document.body.innerHTML = '<h1 style="color: #EA4335;">Error: No game specified</h1>'
    } else {
      // Set game title
      const gameTitle = GAME_TITLES[gameName] || gameName.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')
      document.getElementById('game-title').textContent = gameTitle

      // Note: Score is updated directly by the game script via DOM manipulation

      // Dynamically load the game script
      const script = document.createElement('script')
      script.type = 'module'
      script.src = `/games/${gameName}.js`
      script.onerror = () => {
        console.error(`Failed to load game: ${gameName}`)
        document.body.innerHTML = `<h1 style="color: #EA4335;">Error: Game "${gameName}" not found</h1>`
      }
      document.body.appendChild(script)

      console.log(`Loading game: ${gameName}`)
    }

    // ===== THEME SYSTEM =====
    // Listen for theme changes from parent window
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'themeChange') {
        const theme = event.data.payload?.theme
        if (theme === 'day' || theme === 'night') {
          applyTheme(theme)
          console.log(`game-wrapper: Theme changed to ${theme}`)
        }
      }
    })

    function applyTheme(theme) {
      const isDark = theme === 'night'
      const textColor = isDark ? '#E8EAED' : '#202124'

      // Update all text elements
      document.getElementById('game-title').style.color = textColor
      document.querySelectorAll('.stat-label').forEach(el => el.style.color = textColor)
      document.querySelectorAll('.stat-value').forEach(el => el.style.color = textColor)
    }
  </script>
</body>
</html>
